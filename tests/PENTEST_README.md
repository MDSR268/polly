# Polly Security Penetration Testing Suite

This directory contains comprehensive security penetration testing tools for the Polly Discord Poll Bot application.

## Overview

The penetration testing suite is designed to identify security vulnerabilities in both the API endpoints and web interface of the Polly application. It covers a wide range of security concerns including authentication, input validation, file uploads, and business logic flaws.

## Test Files

### Core Test Suites

1. **`test_pentest.py`** - Main API and backend penetration tests
   - Authentication and authorization vulnerabilities
   - Input validation and injection attacks (SQL, XSS, Command)
   - File upload security testing
   - API endpoint security
   - Business logic vulnerabilities
   - Information disclosure testing
   - CSRF and clickjacking protection
   - Database security testing

2. **`test_web_pentest.py`** - Web interface penetration tests
   - Client-side security vulnerabilities
   - Security headers analysis
   - Content Security Policy testing
   - Sensitive data exposure detection
   - Path traversal attacks
   - HTTP method tampering
   - Authentication bypass attempts
   - Session management security
   - Rate limiting testing
   - CORS configuration analysis

3. **`run_pentest.py`** - Comprehensive test runner with reporting
   - Executes all penetration test suites
   - Generates detailed security reports
   - Provides risk assessment and recommendations
   - Saves results to JSON format for further analysis

## Security Test Categories

### 1. Authentication Security
- JWT token manipulation attacks
- Token expiration handling
- Privilege escalation attempts
- Session fixation vulnerabilities
- OAuth callback manipulation
- Authentication bypass techniques

### 2. Input Validation Security
- SQL injection testing (basic and advanced)
- Cross-Site Scripting (XSS) vulnerabilities
- Path traversal attacks
- Command injection testing
- Parameter pollution
- Mass assignment attacks

### 3. File Upload Security
- Malicious file upload attempts
- File type validation bypass
- Oversized file handling
- Path traversal in file uploads
- File execution prevention

### 4. API Endpoint Security
- Unauthorized access testing
- Poll manipulation attacks
- Rate limiting validation
- HTTP method tampering
- Business logic bypass attempts

### 5. Web Interface Security
- Security headers presence and strength
- Content Security Policy analysis
- Sensitive data exposure detection
- Information disclosure in errors
- Client-side validation bypass
- Session management security

### 6. Business Logic Security
- Poll time manipulation
- Option limit bypass
- Emoji injection attacks
- CORS configuration testing
- Rate limiting effectiveness

## Running the Tests

### Prerequisites

```bash
# Install required dependencies
pip install pytest httpx requests selenium fastapi jose python-multipart

# For browser-based tests (optional)
# Install ChromeDriver for Selenium tests
```

### Quick Start

#### Local Testing
```bash
# Run all penetration tests against local server (localhost:8000)
python tests/run_pentest.py

# Run only API/backend tests
python -m pytest tests/test_pentest.py -v

# Run only web interface tests
python -m pytest tests/test_web_pentest.py -v

# Run specific test class
python -m pytest tests/test_pentest.py::TestAuthenticationSecurity -v
```

#### Live Server Testing
```bash
# Test against live server at polly.pacnp.al
python tests/run_live_pentest.py

# Test against custom URL
python tests/run_live_pentest.py --url https://your-server.com

# Run only web interface tests on live server
python tests/run_live_pentest.py --web-only

# Run only API tests on live server
python tests/run_live_pentest.py --api-only

# Save detailed report to custom file
python tests/run_live_pentest.py --output security_report.json

# Quick security check (headers and basic endpoints)
python -c "from tests.run_live_pentest import run_quick_security_check; run_quick_security_check()"
```

### Advanced Usage

```bash
# Run tests with detailed output
python tests/run_pentest.py --verbose

# Run tests and save detailed logs
python tests/run_pentest.py > security_test_results.log 2>&1

# Run specific vulnerability category
python -m pytest tests/test_pentest.py::TestInputValidationSecurity -v -s
```

## Test Results and Reporting

### Report Format

The test runner generates comprehensive reports including:

- **Executive Summary**: Overall security posture and risk level
- **Test Results**: Detailed pass/fail status for each test category
- **Critical Issues**: High-priority security vulnerabilities found
- **Recommendations**: Specific actions to improve security
- **Detailed Logs**: Complete test execution details

### Risk Levels

- **MINIMAL**: Few or no security issues detected
- **LOW**: Minor security concerns that should be addressed
- **MEDIUM**: Moderate security issues requiring attention
- **HIGH**: Critical security vulnerabilities requiring immediate action

### Sample Report Output

```
üìã SECURITY PENETRATION TEST REPORT
================================================================================
Test Duration: 45.23 seconds
Timestamp: 2025-09-03 13:45:12

üìä SUMMARY
----------------------------------------
Total Tests: 87
Passed: 82 ‚úÖ
Failed: 5 ‚ùå
Success Rate: 94.3%
Risk Level: LOW

üö® CRITICAL SECURITY ISSUES
----------------------------------------
‚ùå Input validation issues detected in TestInputValidationSecurity
‚ùå File upload security issues detected in TestFileUploadSecurity

üí° SECURITY RECOMMENDATIONS
----------------------------------------
 1. Implement comprehensive input validation and sanitization
 2. Implement strict file upload validation and sandboxing
 3. Add security headers (CSP, X-Frame-Options, etc.)
 4. Implement rate limiting on all API endpoints
 5. Use HTTPS in production with proper SSL/TLS configuration
```

## Security Test Scenarios

### Authentication Tests
- **JWT Manipulation**: Tests token tampering and signature validation
- **Token Expiration**: Verifies proper handling of expired tokens
- **Privilege Escalation**: Attempts to access admin functions with regular user tokens
- **Session Management**: Tests session security attributes and lifecycle

### Input Validation Tests
- **SQL Injection**: Tests various SQL injection payloads in form inputs
- **XSS Testing**: Attempts to inject malicious scripts in user inputs
- **Path Traversal**: Tests directory traversal attacks in file paths
- **Command Injection**: Tests OS command execution through user inputs

### File Upload Tests
- **Malicious Files**: Attempts to upload executable files and scripts
- **Type Bypass**: Tests file extension and MIME type validation bypass
- **Size Limits**: Tests handling of oversized file uploads
- **Path Manipulation**: Tests path traversal in uploaded file names

### API Security Tests
- **Unauthorized Access**: Tests access to protected endpoints without authentication
- **Parameter Manipulation**: Tests manipulation of API parameters
- **Rate Limiting**: Tests API rate limiting effectiveness
- **Method Tampering**: Tests unexpected HTTP methods on endpoints

## Customization

### Adding New Tests

1. **Create Test Class**: Add new test classes to existing files or create new test files
2. **Follow Naming Convention**: Use `test_` prefix for test methods
3. **Add to Integration**: Include new test classes in integration test runners
4. **Update Documentation**: Document new test scenarios in this README

### Example New Test

```python
class TestCustomSecurity:
    """Test custom security scenarios"""
    
    def setup_method(self):
        self.pentest = PentestSuite()
    
    def test_custom_vulnerability(self):
        """Test for custom vulnerability"""
        # Test implementation
        response = self.pentest.client.get("/custom-endpoint")
        assert response.status_code != 500
```

### Configuration

Tests can be configured by modifying:
- **Base URL**: Change `base_url` in test suite initialization
- **Test Payloads**: Modify payload lists in test methods
- **Timeout Values**: Adjust timeout values for slow endpoints
- **Report Format**: Customize report generation in `run_pentest.py`

## Security Best Practices

### For Developers

1. **Regular Testing**: Run penetration tests regularly during development
2. **Fix Critical Issues**: Address high-risk vulnerabilities immediately
3. **Input Validation**: Implement comprehensive input validation on all endpoints
4. **Authentication**: Use secure authentication mechanisms with proper validation
5. **Error Handling**: Implement proper error handling without information disclosure

### For Deployment

1. **HTTPS Only**: Use HTTPS in production environments
2. **Security Headers**: Implement all recommended security headers
3. **Rate Limiting**: Apply rate limiting to prevent abuse
4. **Monitoring**: Implement comprehensive logging and monitoring
5. **Updates**: Keep all dependencies updated with security patches

## Troubleshooting

### Common Issues

1. **Import Errors**: Ensure all dependencies are installed and paths are correct
2. **Connection Errors**: Verify the application is running on the expected port
3. **Permission Errors**: Check file permissions for report generation
4. **Browser Tests**: Ensure ChromeDriver is installed for Selenium tests

### Debug Mode

```bash
# Run with debug output
python -m pytest tests/test_pentest.py -v -s --tb=long

# Run single test with maximum verbosity
python -m pytest tests/test_pentest.py::TestAuthenticationSecurity::test_jwt_token_manipulation -v -s
```

## Contributing

When contributing to the penetration testing suite:

1. **Follow Standards**: Use consistent coding standards and naming conventions
2. **Document Tests**: Add clear documentation for new test scenarios
3. **Test Coverage**: Ensure new features have corresponding security tests
4. **Review Process**: Have security tests reviewed by security-aware team members

## Security Disclaimer

This penetration testing suite is designed for testing the security of the Polly application in authorized environments only. Do not use these tools against systems you do not own or have explicit permission to test. Always follow responsible disclosure practices when reporting security vulnerabilities.

## Contact

For questions about the penetration testing suite or security concerns, please contact the development team or create an issue in the project repository.
